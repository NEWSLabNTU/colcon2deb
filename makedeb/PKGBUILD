#!/usr/bin/env bash
# Maintainer: Autoware Foundation <contact@autoware.org>

pkgname=colcon2deb
pkgver=0.2.0
pkgrel=1
pkgdesc="Build Debian packages for Autoware in isolated Docker containers"
arch=('all')
url="https://github.com/autowarefoundation/colcon2deb"
license=('Apache-2.0')

depends=(
    'python3>=3.10'
    'python3-pip'
    'python3-yaml'
    'python3-docker'
    'python3-requests'
)
optdepends=(
    'docker.io: Docker runtime for building packages'
)

makedepends=(
    'python3-pip'
)

source=(
    'colcon2deb'
    "colcon2deb-${pkgver}-py3-none-any.whl"
)
sha256sums=(
    'SKIP'
    'SKIP'
)

package() {
    # Create installation directories
    install -dm755 "${pkgdir}/opt/${pkgname}"
    install -dm755 "${pkgdir}/usr/bin"

    # Install the wheel package to /opt/colcon2deb
    pip install --target="${pkgdir}/opt/${pkgname}" \
                --no-deps \
                --no-compile \
                "${srcdir}/colcon2deb-${pkgver}-py3-none-any.whl"

    # Install the wrapper script
    install -Dm755 "${srcdir}/colcon2deb" "${pkgdir}/usr/bin/colcon2deb"
}

# vim: set ts=4 sw=4 et:
