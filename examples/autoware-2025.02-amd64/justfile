# Autoware 2025.02 AMD64 Debian Package Builder

# Default recipe: list all available recipes
default:
    @just --list

# Build Debian packages for Autoware 2025.02
build:
    #!/usr/bin/env bash
    set -e

    # Check if colcon2deb is available
    if ! command -v colcon2deb &> /dev/null; then
        echo "Error: colcon2deb is not available."
        echo "Please install it first:"
        echo "  cd ${PROJECT_ROOT}"
        echo "  uv sync  # Install dependencies"
        exit 1
    fi

    # Run colcon2deb
    colcon2deb --workspace source --config config.yaml

# Build with verbose output (show all logs in real-time)
build-verbose:
    #!/usr/bin/env bash
    set -e

    # Check if colcon2deb is available
    if ! command -v colcon2deb &> /dev/null; then
        echo "Error: colcon2deb is not available."
        echo "Please install it first:"
        echo "  cd ${PROJECT_ROOT}"
        echo "  uv sync  # Install dependencies"
        exit 1
    fi

    # Run colcon2deb with verbose flag
    colcon2deb --workspace source --config config.yaml --verbose

# Clean build artifacts
clean:
    @echo "Cleaning build directory..."
    rm -rf build/
    @echo "✓ Clean complete"

# Rebuild Docker image
rebuild-image:
    @echo "Rebuilding Docker image..."
    docker build -t autoware-2025.02-builder .
    @echo "✓ Docker image rebuilt"

# Clean and rebuild everything
rebuild: clean rebuild-image build
